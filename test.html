<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Tukar Koin PI Network | TukarPI.ID - Aman & Cepat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://api.coingecko.com">
  <link rel="preload" as="image" href="https://bakti02.github.io/TukarPI.ID/flame-21186.gif">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .crypto-container {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      padding-bottom: 0.5rem;
    }
    .crypto-card {
      position: relative;
      flex: 0 0 calc(20% - 1rem);
      transition: all 0.3s ease;
    }
    @keyframes pulse-up {
      0% { background-color: rgba(74, 222, 128, 0.1); }
      100% { background-color: transparent; }
    }
    @keyframes pulse-down {
      0% { background-color: rgba(239, 68, 68, 0.1); }
      100% { background-color: transparent; }
    }
    .price-up { animation: pulse-up 1s; }
    .price-down { animation: pulse-down 1s; }
    .flame-badge {
      position: absolute;
      right: -8px;
      top: -8px;
      width: 24px;
      height: 24px;
      z-index: 10;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
    }
    .percentage-change {
      display: inline-block;
      padding: 0 3px;
      border-radius: 2px;
      font-weight: 600;
      font-size: 10px;
      border: 0.5px solid rgba(255, 255, 255, 0.5);
      line-height: 1.2;
    }
    .percentage-up { background-color: rgba(16, 185, 129, 0.9); color: white; }
    .percentage-down { background-color: rgba(239, 68, 68, 0.9); color: white; }
    .recommendation-card {
      transition: all 0.3s ease;
      transform: translateY(0);
    }
    .recommendation-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
    }
    .risk-bar {
      height: 6px;
      border-radius: 3px;
      background: linear-gradient(90deg, #4ade80 0%, #f59e0b 50%, #ef4444 100%);
    }
    .risk-progress {
      height: 100%;
      border-radius: 3px;
      background-color: white;
    }
    .loading-spinner {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 text-[10px] md:text-sm">
  <div class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-lg sticky top-0 z-50">
      <div class="container mx-auto px-4">
        <div class="flex justify-between items-center py-3">
          <div class="flex items-center space-x-2">
            <img src="https://bakti02.github.io/TukarPI.ID/logo-jasa-tukar-pi-network.png" alt="TukarPI.ID" class="h-8">
            <div>
              <h1 class="text-lg font-bold">TukarPI.ID</h1>
              <p class="text-xs opacity-80 font-bold">Pusat Jual & Beli Kripto</p>
            </div>
          </div>
          <span class="text-xs bg-blue-400 text-white px-2 py-1 rounded-full font-bold hidden md:block">200+ Aset</span>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="p-3 space-y-8 container mx-auto">
      <!-- Welcome Section -->
      <section class="bg-white rounded-xl shadow p-3 md:p-5">
        <h2 class="text-base md:text-lg font-semibold text-gray-800 mb-1">Selamat Datang di TukarPi Dashboard</h2>
        <p class="text-gray-600 text-[10px]">Pantau harga 200+ aset kripto secara realtime</p>
      </section>

      <!-- Recommendations Section -->
      <section class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100">
        <div class="flex items-center mb-4">
          <svg class="w-5 h-5 text-yellow-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"/>
          </svg>
          <h2 class="text-lg font-bold text-gray-800">üî• Rekomendasi Beli Hari Ini</h2>
          <span class="ml-auto bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full hidden sm:inline">Auto-update</span>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3" id="recommendation-container">
          <!-- Loading State -->
          <div class="col-span-full bg-white p-4 rounded-lg flex flex-col items-center justify-center">
            <div class="loading-spinner rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500 mb-2"></div>
            <p class="text-gray-600 text-sm">Memuat rekomendasi...</p>
          </div>
        </div>

        <div class="mt-3 text-xs text-gray-500 flex justify-between items-center">
          <p>‚è∞ Pembaruan: <span id="last-updated">-</span></p>
          <button onclick="refreshRecommendations()" class="text-blue-600 hover:text-blue-800 flex items-center">
            <i class="fas fa-sync-alt mr-1 text-xs"></i> Refresh
          </button>
        </div>
      </section>

      <!-- Crypto Market Section -->
      <section class="relative">
        <div class="flex justify-between items-center mb-3 flex-wrap gap-2">
          <h2 class="text-sm md:text-base font-semibold">Harga Kripto Realtime</h2>
          <div class="flex gap-2 flex-wrap" id="filter-buttons">
            <button class="filter-btn active" data-filter="all">Semua</button>
            <button class="filter-btn" data-filter="payment">Pembayaran</button>
            <button class="filter-btn" data-filter="stable">Stablecoin</button>
            <button class="filter-btn" data-filter="defi">DeFi</button>
            <button class="filter-btn" data-filter="meme">Meme</button>
            <button class="filter-btn" data-filter="layer1">Layer 1</button>
            <button class="filter-btn" data-filter="layer2">Layer 2</button>
          </div>
        </div>
        
        <div>
          <div class="crypto-container" id="crypto-container">
            <!-- Skeleton Loader -->
            <div class="crypto-card bg-gray-200 rounded-xl h-24 animate-pulse"></div>
            <div class="crypto-card bg-gray-200 rounded-xl h-24 animate-pulse"></div>
            <div class="crypto-card bg-gray-200 rounded-xl h-24 animate-pulse"></div>
            <div class="crypto-card bg-gray-200 rounded-xl h-24 animate-pulse"></div>
            <div class="crypto-card bg-gray-200 rounded-xl h-24 animate-pulse"></div>
          </div>
          <button class="show-more-btn" id="show-more-btn">Tampilkan Semua</button>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 py-8 mt-auto">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-8">
          <div class="col-span-2 md:col-span-1">
            <img src="https://bakti02.github.io/TukarPI.ID/logo-jasa-tukar-pi-network.png" alt="TukarPI.ID" class="h-8 mb-3">
            <p class="text-xs md:text-sm mb-3">Platform tukar koin PI Network ke Rupiah tercepat dan terpercaya di Indonesia.</p>
            <div class="flex space-x-3">
              <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-instagram"></i></a>
              <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-twitter"></i></a>
              <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-telegram"></i></a>
            </div>
          </div>
          <div>
            <h3 class="text-white font-bold mb-3 text-sm md:text-base">Layanan</h3>
            <ul class="space-y-2">
              <li><a href="#" class="hover:text-white transition text-xs md:text-sm">Jual PI Network</a></li>
              <li><a href="#" class="hover:text-white transition text-xs md:text-sm">Beli Kripto</a></li>
              <li><a href="#" class="hover:text-white transition text-xs md:text-sm">Program Affiliate</a></li>
            </ul>
          </div>
          <div>
            <h3 class="text-white font-bold mb-3 text-sm md:text-base">Bantuan</h3>
            <ul class="space-y-2">
              <li><a href="#" class="hover:text-white transition text-xs md:text-sm">Panduan Penukaran</a></li>
              <li><a href="#" class="hover:text-white transition text-xs md:text-sm">FAQ</a></li>
              <li><a href="#" class="hover:text-white transition text-xs md:text-sm">Syarat & Ketentuan</a></li>
            </ul>
          </div>
          <div class="col-span-2 md:col-span-1">
            <h3 class="text-white font-bold mb-3 text-sm md:text-base">Kontak</h3>
            <ul class="space-y-2">
              <li class="flex items-center">
                <i class="fas fa-envelope mr-2 text-xs md:text-sm"></i>
                <span class="text-xs md:text-sm">cs@tukarpi.id</span>
              </li>
              <li class="flex items-center">
                <i class="fab fa-whatsapp mr-2 text-xs md:text-sm"></i>
                <a href="https://wa.me/6282147510780" class="text-xs md:text-sm hover:text-white">+62 821-4751-0780</a>
              </li>
              <li class="flex items-center">
                <i class="fas fa-clock mr-2 text-xs md:text-sm"></i>
                <span class="text-xs md:text-sm">08:00 - 22:00 WIB</span>
              </li>
            </ul>
          </div>
        </div>
        <div class="border-t border-gray-800 mt-6 pt-6 text-xs text-center">
          <p>&copy; 2025 TukarPI.ID. All rights reserved.</p>
        </div>
      </div>
    </footer>
  </div>

  <!-- Floating WhatsApp Button -->
  <a href="https://wa.me/6282147510780" class="fixed bottom-4 right-4 bg-green-500 hover:bg-green-600 text-white w-12 h-12 rounded-full flex items-center justify-center shadow-xl transition transform hover:scale-110 z-50">
    <i class="fab fa-whatsapp text-xl"></i>
  </a>

  <script>
    // ======================
    // KONFIGURASI UTAMA
    // ======================
    const coinCategories = {
      payment: ['bitcoin', 'ethereum', 'litecoin', 'bitcoin-cash', 'ripple', 'stellar', 'dash'],
      stable: ['tether', 'usd-coin', 'binance-usd', 'dai', 'true-usd'],
      defi: ['uniswap', 'aave', 'chainlink', 'wrapped-bitcoin', 'the-graph'],
      meme: ['dogecoin', 'shiba-inu', 'dogelon-mars', 'pepe', 'bonk'],
      layer1: ['ethereum', 'solana', 'cardano', 'avalanche', 'polkadot'],
      layer2: ['arbitrum', 'optimism', 'polygon', 'base', 'starknet']
    };

    // ======================
    // FUNGSI UTAMA
    // ======================
    
    // Format harga
    function formatPrice(price) {
      if (price >= 1) return `$${price.toLocaleString(undefined, { maximumFractionDigits: 4 })}`;
      if (price >= 0.01) return `$${price.toFixed(4).replace(/\.?0+$/, '')}`;
      if (price >= 0.0001) return `$${price.toFixed(6).replace(/\.?0+$/, '')}`;
      
      const formatted = price.toFixed(12);
      const trimmed = formatted.replace(/(\..*?)0+$/, '$1').replace(/\.$/, '');
      const isTruncated = price.toString().length > trimmed.length + 1;
      
      return `<span class="price-micro">$${trimmed}${isTruncated ? '<span class="truncate-mark">></span>' : ''}</span>`;
    }

    // Analisis untuk rekomendasi
    function analyzeCoin(coin) {
      // Hitung skor dasar (0-100)
      const score = Math.min(100, 
        30 + // Base score
        (Math.min(coin.price_change_percentage_24h, 20) * 1.5) + // Max 30 points
        (Math.min(coin.price_change_percentage_7d, 30) * 0.8) + // Max 24 points
        ((coin.total_volume / coin.market_cap > 0.005) ? 15 : 0) // Volume bonus
      );
      
      // Generate alasan rekomendasi
      const reasons = [];
      if (coin.price_change_percentage_24h > 5) reasons.push("Momentum 24h");
      if (coin.price_change_percentage_7d > 10) reasons.push("Trend mingguan");
      if ((coin.total_volume / coin.market_cap) > 0.01) reasons.push("Volume tinggi");
      
      return {
        score: Math.round(score),
        reasons: reasons.length ? reasons : ["Potensi teknis"]
      };
    }

    // Render kartu rekomendasi
    function renderRecommendations(coins) {
      const container = document.getElementById('recommendation-container');
      
      // Clear previous content
      container.innerHTML = '';
      
      // Get top 3 coins
      const topCoins = coins.slice(0, 3);
      
      if (topCoins.length === 0) {
        container.innerHTML = `
          <div class="col-span-full bg-yellow-50 text-yellow-800 p-4 rounded-lg text-center">
            <p class="text-sm">Tidak ada rekomendasi saat ini</p>
            <p class="text-xs mt-1">Coba gunakan filter berbeda atau refresh halaman</p>
          </div>
        `;
        return;
      }
      
      topCoins.forEach(coin => {
        const isPositive = coin.price_change_percentage_24h >= 0;
        const riskPercent = 100 - coin.analysis.score;
        
        const card = document.createElement('div');
        card.className = 'recommendation-card bg-white p-3 rounded-lg shadow-sm border-l-4 border-blue-400 relative';
        card.innerHTML = `
          <div class="flex items-start">
            <img src="${coin.image}" class="w-8 h-8 mr-3" alt="${coin.name}" loading="lazy">
            <div class="flex-1">
              <div class="flex justify-between">
                <h3 class="font-bold text-sm">${coin.symbol.toUpperCase()}</h3>
                <span class="text-xs px-2 py-0.5 rounded-full ${
                  coin.analysis.score > 85 ? 'bg-green-100 text-green-800' :
                  coin.analysis.score > 70 ? 'bg-blue-100 text-blue-800' :
                  'bg-yellow-100 text-yellow-800'
                }">Skor: ${coin.analysis.score}</span>
              </div>
              <p class="text-gray-500 text-xs mb-1">${coin.name}</p>
              <p class="text-sm font-medium">$${coin.current_price.toLocaleString()} 
                <span class="${isPositive ? 'text-green-500' : 'text-red-500'} text-xs">${isPositive ? '+' : ''}${coin.price_change_percentage_24h.toFixed(2)}%</span>
              </p>
            </div>
          </div>
          <div class="mt-2 pl-2">
            <p class="text-xs text-gray-600 mb-1"><span class="font-semibold">Alasan:</span> ${coin.analysis.reasons.join(', ')}</p>
            <div class="flex items-center text-xs text-gray-500">
              <span class="mr-2">Risiko:</span>
              <div class="flex-1 bg-gray-200 rounded-full h-1.5">
                <div class="h-1.5 rounded-full ${
                  coin.analysis.score > 70 ? 'bg-green-500' :
                  coin.analysis.score > 50 ? 'bg-yellow-500' : 'bg-red-500'
                }" style="width: ${coin.analysis.score}%"></div>
              </div>
              <span class="text-xs font-medium ml-2">${riskPercent}%</span>
            </div>
          </div>
        `;
        
        container.appendChild(card);
      });
      
      document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();
    }

    // Refresh rekomendasi
    function refreshRecommendations() {
      const container = document.getElementById('recommendation-container');
      container.innerHTML = `
        <div class="col-span-full bg-white p-4 rounded-lg flex flex-col items-center justify-center">
          <div class="loading-spinner rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500 mb-2"></div>
          <p class="text-gray-600 text-sm">Memperbarui data...</p>
        </div>
      `;
      
      fetchOptimizedData();
    }

    // Render kartu kripto
    function renderOptimizedCards(data) {
      const container = document.getElementById('crypto-container');
      container.innerHTML = '';
      
      data.forEach(coin => {
        // Tentukan kategori coin
        let category = 'other';
        for (const [cat, coins] of Object.entries(coinCategories)) {
          if (coins.includes(coin.id)) {
            category = cat;
            break;
          }
        }
        
        const card = document.createElement('div');
        card.className = `crypto-card bg-white rounded-xl shadow p-2 flex flex-col items-center text-center border-t-4 ${
          coin.price_change_percentage_24h >= 0 ? 'border-green-500' : 'border-red-500'
        }`;
        card.dataset.category = category;

        const img = document.createElement('img');
        img.className = 'w-6 h-6 mb-1';
        img.alt = coin.name;
        img.src = coin.image;
        img.loading = "lazy";
        
        card.innerHTML = `
          ${coin.price_change_percentage_24h >= 5 ? `
            <img src="https://bakti02.github.io/TukarPI.ID/flame-21186.gif" 
                 class="flame-badge" 
                 loading="lazy"
                 alt="Kenaikan signifikan">
          ` : ''}
          <h3 class="text-[10px] font-semibold">${coin.symbol.toUpperCase()}</h3>
          <p class="text-xs font-bold" data-current-price="${coin.current_price}">
            ${formatPrice(coin.current_price)}
          </p>
          <span class="percentage-change ${
            coin.price_change_percentage_24h >= 0 ? 'percentage-up' : 'percentage-down'
          }">
            ${coin.price_change_percentage_24h >= 0 ? '+' : ''}${coin.price_change_percentage_24h.toFixed(2)}%
          </span>
        `;
        
        card.prepend(img);
        container.appendChild(card);
      });
      
      limitInitialDisplay();
      container.dataset.filtered = 'all';
    }

    // Filter koin
    function filterCoins(category) {
      const container = document.getElementById('crypto-container');
      const cards = container.querySelectorAll('.crypto-card');
      const showMoreBtn = document.getElementById('show-more-btn');
      
      container.dataset.filtered = category;
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === category);
      });

      const cardsPerRow = window.innerWidth < 640 ? 3 : 5;
      const initialLimit = cardsPerRow * 2;
      let visibleCount = 0;
      let totalFiltered = 0;
      
      cards.forEach(card => {
        if (category === 'all' || card.dataset.category === category) {
          totalFiltered++;
          if (visibleCount < initialLimit) {
            card.style.display = 'flex';
            visibleCount++;
          } else {
            card.style.display = 'none';
          }
        } else {
          card.style.display = 'none';
        }
      });

      showMoreBtn.classList.toggle('visible', totalFiltered > initialLimit);
    }

    // Batasi tampilan awal
    function limitInitialDisplay() {
      const container = document.getElementById('crypto-container');
      const activeFilter = container.dataset.filtered || 'all';
      const cards = container.querySelectorAll('.crypto-card');
      const showMoreBtn = document.getElementById('show-more-btn');
      
      const cardsPerRow = window.innerWidth < 640 ? 3 : 5;
      const initialLimit = cardsPerRow * 2;
      let visibleCount = 0;
      let totalFiltered = 0;

      cards.forEach(card => {
        if (activeFilter === 'all' || card.dataset.category === activeFilter) {
          totalFiltered++;
          if (visibleCount < initialLimit) {
            card.style.display = 'flex';
            visibleCount++;
          } else {
            card.style.display = 'none';
          }
        }
      });

      showMoreBtn.classList.toggle('visible', totalFiltered > initialLimit);
    }

    // Tampilkan semua koin
    function showAllCards() {
      const container = document.getElementById('crypto-container');
      const activeFilter = container.dataset.filtered || 'all';
      const cards = container.querySelectorAll('.crypto-card');
      const showMoreBtn = document.getElementById('show-more-btn');
      
      cards.forEach(card => {
        if (activeFilter === 'all' || card.dataset.category === activeFilter) {
          card.style.display = 'flex';
        }
      });
      
      showMoreBtn.classList.remove('visible');
    }

    // Fetch data dari API
    async function fetchOptimizedData() {
      try {
        const allCoinIds = Object.values(coinCategories).flat();
        const response = await fetch(
          `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${allCoinIds.join(',')}&order=market_cap_desc&per_page=100&page=1&sparkline=false`
        );
        
        if (!response.ok) throw new Error('Gagal memuat data');
        
        let data = await response.json();
        
        // Tambahkan analisis dan urutkan
        data = data.map(coin => ({
          ...coin,
          analysis: analyzeCoin(coin)
        })).sort((a, b) => b.analysis.score - a.analysis.score);
        
        renderOptimizedCards(data);
        renderRecommendations(data);
        
      } catch (error) {
        console.error("Error:", error);
        
        // Tampilkan error di rekomendasi
        document.getElementById('recommendation-container').innerHTML = `
          <div class="col-span-full bg-red-50 text-red-800 p-3 rounded-lg text-sm">
            <p>Gagal memuat rekomendasi: ${error.message}</p>
            <button onclick="refreshRecommendations()" class="text-red-600 underline mt-1">Coba lagi</button>
          </div>
        `;
        
        // Tampilkan error di daftar koin
        document.getElementById('crypto-container').innerHTML = `
          <div class="col-span-full bg-red-50 text-red-800 p-3 rounded-lg text-center">
            <p class="text-sm">Gagal memuat data koin</p>
            <button onclick="fetchOptimizedData()" class="text-red-600 underline text-xs mt-1">Refresh</button>
          </div>
        `;
      }
    }

    // ======================
    // INISIALISASI
    // ======================
    document.addEventListener('DOMContentLoaded', () => {
      // Setup filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          filterCoins(btn.dataset.filter);
        });
      });
      
      // Setup show more button
      document.getElementById('show-more-btn').addEventListener('click', showAllCards);
      
      // Handle resize
      window.addEventListener('resize', limitInitialDisplay);
      
      // Load initial data
      fetchOptimizedData();
    });

    // Auto-update setiap 2 menit
    setInterval(() => {
      if (document.visibilityState === 'visible') {
        fetchOptimizedData();
      }
    }, 120000);
  </script>
</body>
</html>
