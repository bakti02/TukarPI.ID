<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beli Kripto - TukarPI.ID</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <style>
    /* Gaya dari header/footer referensi */
    .header-gradient {
      background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
    }
    .nav-link {
      position: relative;
    }
    .nav-link::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 2px;
      background: white;
      transition: width 0.3s ease;
    }
    .nav-link:hover::after {
      width: 100%;
    }
    .mobile-menu {
      transition: all 0.3s ease;
    }
    
    /* Gaya khusus untuk form kripto */
    .gradient-text {
      background: linear-gradient(90deg, #2563eb 0%, #4f46e5 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .coin-received {
      font-size: 1.25rem;
      font-weight: 700;
      background: linear-gradient(90deg, #2563eb 0%, #4f46e5 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .price-change {
      font-size: 0.8rem;
      padding: 0.2rem 0.4rem;
      border-radius: 0.25rem;
    }
    
    .price-up {
      background-color: rgba(5, 150, 105, 0.1);
      color: #059669;
    }
    
    .price-down {
      background-color: rgba(220, 38, 38, 0.1);
      color: #dc2626;
    }
    
    .wallet-address {
      background-color: #f1f5f9;
      padding: 0.75rem;
      border-radius: 0.5rem;
      word-break: break-all;
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    
    /* Animasi baru */
    .card-hover {
      transition: all 0.3s ease;
      transform: translateY(0);
    }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    /* Popup modern */
    .popup-overlay {
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(5px);
    }
    
    /* Invoice card */
    .invoice-card {
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
      border: 1px solid rgba(255,255,255,0.3);
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
    }
    
    /* Payment card */
    .payment-card {
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
    }
    
    .payment-card.selected {
      border-color: #60a5fa;
      box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.5);
      transform: translateY(-3px);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col bg-gray-100">

  <!-- Header -->
  <header class="header-gradient text-white shadow-lg sticky top-0 z-50">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center py-3">
        <!-- Logo and Brand -->
        <div class="flex items-center space-x-2">
          <img src="https://bakti02.github.io/TukarPI.ID/logo-jasa-tukar-pi-network.png" alt="TukarPI.ID" class="h-8">
          <div>
            <p class="text-xs opacity-80 font-bold">Pusat Jual & Beli Kripto</p>
          </div>
        </div>
        
        <!-- Desktop Navigation -->
        <nav class="hidden md:flex items-center space-x-6">
          <a href="index.html" class="nav-link text-sm font-medium">Home</a>
          <a href="jualkoin.html" class="nav-link text-sm font-medium">Jual Pi</a>
          <a href="belikoin.html" class="nav-link text-sm font-medium">Beli Kripto</a>
          <a href="affiliate.html" class="nav-link text-sm font-medium">Program Affiliate</a>
          <a href="dashboard.html" class="nav-link text-sm font-medium">Live Kripto Realtime</a>
          <span class="text-xs bg-blue-400 text-white px-2 py-1 rounded-full font-bold">500+ Aset</span>
        </nav>
        
        <!-- Mobile Menu Button -->
        <button id="mobile-menu-button" class="md:hidden text-white focus:outline-none">
          <i class="fas fa-bars text-xl"></i>
        </button>
      </div>
    </div>
    
    <!-- Mobile Menu -->
    <div id="mobile-menu" class="mobile-menu hidden md:hidden bg-blue-900 px-4 py-2">
      <div class="flex flex-col space-y-3 py-2">
        <a href="index.html" class="text-white text-sm py-1 border-b border-blue-700">Home</a>
        <a href="jualkoin.html" class="text-white text-sm py-1 border-b border-blue-700">Jual Pi</a>
        <a href="belikoin.html" class="text-white text-sm py-1 border-b border-blue-700">Beli Kripto</a>
        <a href="affiliate.html" class="text-white text-sm py-1 border-b border-blue-700">Program Affiliate</a>
        <a href="dashboard.html" class="text-white text-sm py-1 border-b border-blue-700">Live Kripto Realtime</a>
      </div>
    </div>
  </header>

  <!-- Konten Utama (Form Beli Kripto) -->
  <main class="flex-grow py-8">
    <div class="max-w-md mx-auto px-4">
      <!-- Header Form -->
      <div class="text-center mb-8 animate__animated animate__fadeIn">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-50 rounded-full mb-4">
          <i class="fas fa-shopping-cart text-2xl gradient-text"></i>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Beli Kripto</h1>
        <p class="text-gray-600">Isi form pembelian dan pilih metode pembayaran</p>
      </div>

      <!-- Purchase Form -->
      <div id="purchase-form-container" class="bg-white rounded-xl shadow-md overflow-hidden p-6 animate__animated animate__fadeInUp">
        <form id="purchase-form">
          <!-- Pilihan Kripto -->
          <div class="mb-6">
            <label for="crypto" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
              <i class="fas fa-coins mr-2 text-blue-500"></i> Pilih Kripto
            </label>
            <div class="relative">
              <select id="crypto" class="w-full p-3 pl-10 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white">
                <option value="" disabled selected>Memuat daftar koin...</option>
              </select>
              <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <i class="fas fa-search text-gray-400"></i>
              </div>
            </div>
          </div>

          <!-- Jumlah dalam Rupiah -->
          <div class="mb-6">
            <label for="amount" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
              <i class="fas fa-money-bill-wave mr-2 text-blue-500"></i> Jumlah Pembelian (Rp)
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <span class="text-gray-500">Rp</span>
              </div>
              <input type="text" id="amount" 
                     class="block w-full pl-10 p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" 
                     placeholder="100.000" min="10000" inputmode="numeric">
            </div>
            <p class="text-xs text-gray-500 mt-1">Minimal pembelian Rp 10.000</p>
          </div>

          <!-- Info Harga Real-time -->
          <div class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100 card-hover">
            <div class="flex justify-center mb-3">
              <div id="crypto-logo-container" class="w-16 h-16 rounded-full bg-white flex items-center justify-center shadow-sm">
                <img id="crypto-logo" src="https://bakti02.github.io/TukarPI.ID/logo-jasa-tukar-pi-network.png" alt="Crypto Logo" class="w-10 h-10">
              </div>
            </div>
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm font-medium text-blue-600 flex items-center">
                <i class="fas fa-chart-line mr-1"></i> Harga Real-time
              </span>
              <div class="flex items-center">
                <span id="realtime-price" class="font-semibold text-blue-800">Memuat harga...</span>
                <span id="price-change" class="price-change ml-2 hidden"></span>
              </div>
            </div>
            <div class="flex justify-between mb-2">
              <span class="text-sm font-medium text-blue-600 flex items-center">
                <i class="fas fa-percentage mr-1"></i> Biaya Layanan (5%)
              </span>
              <span id="fee-amount" class="font-medium text-red-500">- Rp 0</span>
            </div>
            <div class="pt-3 border-t border-blue-200">
              <p class="text-xs font-medium text-blue-500 mb-1 flex items-center">
                <i class="fas fa-coins mr-1"></i> JUMLAH KOIN DITERIMA
              </p>
              <div class="flex justify-between items-center">
                <span class="text-sm text-blue-600">Estimasi yang akan Anda terima</span>
                <span id="coin-received" class="coin-received">0</span>
              </div>
            </div>
            <div class="flex items-center justify-between mt-2 text-xs text-gray-500">
              <span id="current-rate">Kurs USD-IDR: Rp0</span>
              <span id="rate-updated">Update: -</span>
            </div>
          </div>

          <!-- Alamat Wallet -->
          <div class="mb-6">
            <label for="wallet" class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
              <i class="fas fa-wallet mr-2 text-blue-500"></i> Alamat Wallet Anda
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <i class="fas fa-address-card text-gray-400"></i>
              </div>
              <input type="text" id="wallet" 
                     class="block w-full pl-10 p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" 
                     placeholder="Contoh: bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq" required>
            </div>
            <p class="text-xs text-gray-500 mt-1">Pastikan alamat wallet benar. Kripto akan dikirim ke alamat ini.</p>
          </div>

          <!-- Metode Pembayaran -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
              <i class="fas fa-credit-card mr-2 text-blue-500"></i> Metode Pembayaran
            </label>
            <div class="grid grid-cols-2 gap-3">
              <div class="payment-card rounded-lg p-3 cursor-pointer border border-gray-200 hover:border-blue-300" data-method="bca">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/5c/Bank_Central_Asia.svg" alt="BCA" class="h-6 mx-auto mb-1">
                <p class="text-xs text-center text-gray-600">Bank BCA</p>
              </div>
              <div class="payment-card rounded-lg p-3 cursor-pointer border border-gray-200 hover:border-blue-300" data-method="dana">
                <img src="https://upload.wikimedia.org/wikipedia/commons/7/72/Logo_dana_blue.svg" alt="DANA" class="h-6 mx-auto mb-1">
                <p class="text-xs text-center text-gray-600">DANA</p>
              </div>
              <div class="payment-card rounded-lg p-3 cursor-pointer border border-gray-200 hover:border-blue-300" data-method="ovo">
                <img src="https://upload.wikimedia.org/wikipedia/commons/e/eb/Logo_ovo_purple.svg" alt="OVO" class="h-6 mx-auto mb-1">
                <p class="text-xs text-center text-gray-600">OVO</p>
              </div>
              <div class="payment-card rounded-lg p-3 cursor-pointer border border-gray-200 hover:border-blue-300" data-method="gopay">
                <img src="https://upload.wikimedia.org/wikipedia/commons/8/86/Gopay_logo.svg" alt="GOPAY" class="h-6 mx-auto mb-1">
                <p class="text-xs text-center text-gray-600">GOPAY</p>
              </div>
            </div>
            <input type="hidden" id="payment-method" required>
          </div>

          <button type="submit" class="w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium rounded-lg shadow-md transition-all duration-300 transform hover:scale-[1.01]">
            <i class="fas fa-arrow-right mr-2"></i> Lanjutkan Pembayaran
          </button>
        </form>
      </div>
    </div>

    <!-- Payment Info -->
    <div id="payment-info" class="hidden max-w-md mx-auto px-4 py-8 fade-in">
      <div class="bg-white rounded-xl shadow-md overflow-hidden p-6">
        <div class="flex justify-between items-center mb-4">
          <button onclick="backToForm()" class="text-blue-600 hover:text-blue-800 flex items-center">
            <i class="fas fa-arrow-left mr-1"></i> Kembali
          </button>
          <h2 class="text-xl font-bold text-gray-800">Selesaikan Pembayaran</h2>
          <div class="w-8"></div>
        </div>

        <!-- Detail Pesanan -->
        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
          <h3 class="text-lg font-semibold text-gray-700 mb-3 flex items-center">
            <i class="fas fa-receipt mr-2 text-blue-500"></i> Detail Pesanan
          </h3>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-gray-600">Kripto</span>
              <span id="confirm-crypto" class="font-medium">BTC</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Jumlah Pembelian</span>
              <span id="confirm-amount" class="font-medium">Rp 0</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Jumlah Koin</span>
              <span id="confirm-coin" class="coin-received">0</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-600">Metode Pembayaran</span>
              <div id="confirm-method" class="flex items-center">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/5c/Bank_Central_Asia.svg" alt="Payment" class="h-5 mr-1">
                <span class="text-sm">BCA</span>
              </div>
            </div>
            <div class="flex justify-between items-start">
              <span class="text-gray-600">Alamat Wallet</span>
              <span id="confirm-wallet" class="wallet-address text-sm text-right max-w-[200px]">-</span>
            </div>
            <div class="flex justify-between border-t border-gray-200 pt-3 mt-2">
              <span class="font-medium">Total Pembayaran</span>
              <span id="confirm-total" class="font-bold text-blue-600">Rp 0</span>
            </div>
          </div>
          <div class="flex items-center justify-between mt-3 text-xs text-gray-500">
            <span id="confirm-exchange-rate">Kurs USD-IDR: Rp0</span>
            <span id="confirm-rate-updated">Update: -</span>
          </div>
        </div>

        <!-- Info Pembayaran -->
        <div id="payment-details">
          <h3 class="text-lg font-semibold text-gray-700 mb-3 flex items-center">
            <i class="fas fa-qrcode mr-2 text-blue-500"></i> Instruksi Pembayaran
          </h3>
          
          <!-- BCA -->
          <div id="bca-details" class="hidden bg-blue-50 p-6 rounded-lg mb-4">
            <div class="text-center mb-4">
              <img src="https://upload.wikimedia.org/wikipedia/commons/5/5c/Bank_Central_Asia.svg" alt="BCA" class="h-8 mx-auto mb-3">
              <h4 class="font-medium text-gray-700">Transfer Bank BCA</h4>
            </div>
            <div class="space-y-3 mb-4">
              <div>
                <p class="text-sm text-gray-600 mb-1">Nomor Rekening</p>
                <div class="font-mono text-lg bg-white py-2 px-4 rounded text-center">0332997201</div>
              </div>
              <div>
                <p class="text-sm text-gray-600 mb-1">Atas Nama</p>
                <p class="bg-white py-2 px-4 rounded text-center">Agus Mulia Bakti</p>
              </div>
            </div>
            <button onclick="copyToClipboard('0332997201')" class="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center transition">
              <i class="fas fa-copy mr-2"></i> Salin Nomor Rekening
            </button>
            <p class="text-xs text-gray-500 mt-3 text-center">Gunakan aplikasi BCA Mobile atau ATM untuk melakukan transfer</p>
          </div>

          <!-- DANA -->
          <div id="dana-details" class="hidden bg-blue-50 p-6 rounded-lg mb-4">
            <div class="text-center mb-4">
              <img src="https://upload.wikimedia.org/wikipedia/commons/7/72/Logo_dana_blue.svg" alt="DANA" class="h-8 mx-auto mb-3">
              <h4 class="font-medium text-gray-700">Transfer via DANA</h4>
            </div>
            <div class="space-y-3 mb-4">
              <div>
                <p class="text-sm text-gray-600 mb-1">Nomor DANA</p>
                <div class="font-mono text-lg bg-white py-2 px-4 rounded text-center">087878787523</div>
              </div>
              <div>
                <p class="text-sm text-gray-600 mb-1">Atas Nama</p>
                <p class="bg-white py-2 px-4 rounded text-center">Agus Mulia Bakti</p>
              </div>
            </div>
            <button onclick="copyToClipboard('087878787523')" class="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center transition">
              <i class="fas fa-copy mr-2"></i> Salin Nomor
            </button>
            <p class="text-xs text-gray-500 mt-3 text-center">Gunakan aplikasi DANA untuk melakukan transfer</p>
          </div>

          <!-- OVO -->
          <div id="ovo-details" class="hidden bg-blue-50 p-6 rounded-lg mb-4">
            <div class="text-center mb-4">
              <img src="https://upload.wikimedia.org/wikipedia/commons/e/eb/Logo_ovo_purple.svg" alt="OVO" class="h-8 mx-auto mb-3">
              <h4 class="font-medium text-gray-700">Transfer via OVO</h4>
            </div>
            <div class="space-y-3 mb-4">
              <div>
                <p class="text-sm text-gray-600 mb-1">Nomor OVO</p>
                <div class="font-mono text-lg bg-white py-2 px-4 rounded text-center">087878787523</div>
              </div>
              <div>
                <p class="text-sm text-gray-600 mb-1">Atas Nama</p>
                <p class="bg-white py-2 px-4 rounded text-center">Agus Mulia Bakti</p>
              </div>
            </div>
            <button onclick="copyToClipboard('087878787523')" class="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center transition">
              <i class="fas fa-copy mr-2"></i> Salin Nomor
            </button>
            <p class="text-xs text-gray-500 mt-3 text-center">Gunakan aplikasi OVO untuk melakukan transfer</p>
          </div>

          <!-- GOPAY -->
          <div id="gopay-details" class="hidden bg-blue-50 p-6 rounded-lg mb-4">
            <div class="text-center mb-4">
              <img src="https://upload.wikimedia.org/wikipedia/commons/8/86/Gopay_logo.svg" alt="GOPAY" class="h-8 mx-auto mb-3">
              <h4 class="font-medium text-gray-700">Transfer via GOPAY</h4>
            </div>
            <div class="space-y-3 mb-4">
              <div>
                <p class="text-sm text-gray-600 mb-1">Nomor GOPAY</p>
                <div class="font-mono text-lg bg-white py-2 px-4 rounded text-center">087878787523</div>
              </div>
              <div>
                <p class="text-sm text-gray-600 mb-1">Atas Nama</p>
                <p class="bg-white py-2 px-4 rounded text-center">Agus Mulia Bakti</p>
              </div>
            </div>
            <button onclick="copyToClipboard('087878787523')" class="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center transition">
              <i class="fas fa-copy mr-2"></i> Salin Nomor
            </button>
            <p class="text-xs text-gray-500 mt-3 text-center">Gunakan aplikasi Gojek untuk melakukan transfer</p>
          </div>
        </div>

        <!-- Tombol Download Invoice dan Konfirmasi -->
        <div class="flex justify-center gap-3 mt-6">
          <button onclick="generateInvoice()" class="flex items-center justify-center px-4 py-2 bg-white border border-blue-500 text-blue-600 rounded-lg hover:bg-blue-50 transition">
            <i class="fas fa-download mr-2"></i> Download Invoice
          </button>
          <button onclick="confirmPayment()" class="flex items-center justify-center px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition">
            <i class="fas fa-check-circle mr-2"></i> Konfirmasi Pembayaran
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-gray-400 py-8 mt-12">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-8">
        <!-- Kolom 1: Tentang Kami -->
        <div class="col-span-2 md:col-span-1">
          <img src="https://bakti02.github.io/TukarPI.ID/logo-jasa-tukar-pi-network.png" alt="TukarPI.ID" class="h-8 mb-3">
          <p class="text-xs md:text-sm mb-3">Platform tukar koin PI Network ke Rupiah tercepat dan terpercaya di Indonesia.</p>
          <div class="flex space-x-3">
            <a href="#" class="text-gray-400 hover:text-white transition">
              <i class="fab fa-instagram text-lg"></i>
            </a>
            <a href="#" class="text-gray-400 hover:text-white transition">
              <i class="fab fa-twitter text-lg"></i>
            </a>
            <a href="#" class="text-gray-400 hover:text-white transition">
              <i class="fab fa-facebook text-lg"></i>
            </a>
            <a href="#" class="text-gray-400 hover:text-white transition">
              <i class="fab fa-telegram text-lg"></i>
            </a>
          </div>
        </div>
        
        <!-- Kolom 2: Layanan -->
        <div>
          <h3 class="text-white font-bold mb-3 text-sm md:text-base">Layanan</h3>
          <ul class="space-y-2">
            <li><a href="jualkoin.html" class="hover:text-white transition text-xs md:text-sm">Jual PI Network Anda</a></li>
            <li><a href="belikoin.html" class="hover:text-white transition text-xs md:text-sm">Beli Kripto</a></li>
            <li><a href="affiliate.html" class="hover:text-white transition text-xs md:text-sm">Program Affiliate</a></li>
            <li><a href="legalitas.html" class="hover:text-white transition text-xs md:text-sm">Legalitas Usaha</a></li>
          </ul>
        </div>
        
        <!-- Kolom 3: Bantuan -->
        <div>
          <h3 class="text-white font-bold mb-3 text-sm md:text-base">Bantuan</h3>
          <ul class="space-y-2">
            <li><a href="panduan-jual-beli.html" class="hover:text-white transition text-xs md:text-sm">Panduan Jual & Beli</a></li>
            <li><a href="faq.html" class="hover:text-white transition text-xs md:text-sm">FAQ</a></li>
            <li><a href="ketentuan.html" class="hover:text-white transition text-xs md:text-sm">Syarat & Ketentuan</a></li>
            <li><a href="policy.html" class="hover:text-white transition text-xs md:text-sm">Kebijakan Privasi</a></li>
          </ul>
        </div>
        
        <!-- Kolom 4: Kontak -->
        <div class="col-span-2 md:col-span-1">
          <h3 class="text-white font-bold mb-3 text-sm md:text-base">Kontak</h3>
          <ul class="space-y-2">
            <li class="flex items-center">
              <i class="fas fa-envelope mr-2 text-xs md:text-sm"></i>
              <span class="text-xs md:text-sm">cs@tukarpi.id</span>
            </li>
            <li class="flex items-center">
              <i class="fab fa-whatsapp mr-2 text-xs md:text-sm"></i>
              <a href="https://wa.me/6282147510780" class="text-xs md:text-sm hover:text-white">+62 821-4751-0780</a>
            </li>
            <li class="flex items-center">
              <i class="fab fa-telegram mr-2 text-xs md:text-sm"></i>
              <a href="https://t.me/tukarpiid" class="text-xs md:text-sm hover:text-white">@tukarpiid</a>
            </li>
            <li class="flex items-center">
              <i class="fas fa-map-marker-alt mr-2 text-xs md:text-sm"></i>
              <span class="text-xs md:text-sm">Jakarta Selatan, Indonesia</span>
            </li>
            <li class="mt-4">
              <h4 class="text-white font-bold mb-2 text-xs md:text-sm">Jam Operasional</h4>
              <p class="text-xs md:text-sm">Senin-Minggu<br>08:00 - 22:00 WIB</p>
            </li>
          </ul>
        </div>
      </div>
      
      <div class="border-t border-gray-800 mt-6 pt-6 text-xs text-center">
        <p>&copy; 2025 TukarPI.ID. All rights reserved.</p>
        <p class="mt-1">PT. Ruang Digital Raya</p>
      </div>
    </div>
  </footer>

  <!-- Floating WhatsApp Button -->
  <a href="https://wa.me/6282147510780" class="fixed bottom-4 right-4 bg-green-500 hover:bg-green-600 text-white w-12 h-12 rounded-full flex items-center justify-center shadow-xl transition transform hover:scale-110 z-50">
    <i class="fab fa-whatsapp text-xl"></i>
  </a>

  <!-- Script Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  
  <script>
    // Data koin default jika API tidak tersedia
    const defaultCryptoData = {
      'USDT': { name: 'Tether', price: 16400, image: 'https://cryptologos.cc/logos/tether-usdt-logo.png' },
      'SHIB': { name: 'Shiba Inu', price: 0.0282, image: 'https://cryptologos.cc/logos/shiba-inu-shib-logo.png' }
    };

    // Variabel global
    let cryptoData = {};
    let exchangeRate = 16400; // Default exchange rate USD to IDR
    let exchangeRateLastUpdated = '';
    let selectedPaymentMethod = '';
    let previousPrices = {}; // Untuk menyimpan harga sebelumnya untuk kalkulasi perubahan

    // Fungsi kembali ke form
    function backToForm() {
      document.getElementById('payment-info').classList.add('hidden');
      document.getElementById('purchase-form-container').classList.remove('hidden');
    }

    // Fungsi mengambil data dari CoinGecko API
    async function fetchCryptoData() {
      try {
        const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=false');
        
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        
        const data = await response.json();
        console.log('Data from CoinGecko:', data);
        
        // Format data
        const formattedData = {};
        data.forEach(coin => {
          const symbol = coin.symbol.toUpperCase();
          formattedData[symbol] = {
            name: coin.name,
            price: coin.current_price,
            image: coin.image,
            lastUpdated: new Date().toISOString()
          };
          
          // Simpan harga sebelumnya untuk kalkulasi perubahan
          if (!previousPrices[symbol]) {
            previousPrices[symbol] = coin.current_price;
          }
        });
        
        return formattedData;
      } catch (error) {
        console.error('Error fetching CoinGecko data:', error);
        console.log('Using default crypto data');
        return defaultCryptoData;
      }
    }

    // Fungsi mengambil kurs USD ke IDR
    async function fetchExchangeRate() {
      try {
        // Coba API pertama
        const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
        const data = await response.json();
        if (data && data.rates && data.rates.IDR) {
          return {
            rate: data.rates.IDR,
            updated: new Date().toISOString()
          };
        }
        
        // Coba API cadangan
        const backupResponse = await fetch('https://api.frankfurter.app/latest?from=USD&to=IDR');
        const backupData = await backupResponse.json();
        if (backupData && backupData.rates && backupData.rates.IDR) {
          return {
            rate: backupData.rates.IDR,
            updated: new Date().toISOString()
          };
        }
        
        // Jika semua API gagal, gunakan nilai default
        return {
          rate: 16400,
          updated: new Date().toISOString()
        };
      } catch (error) {
        console.error('Error fetching exchange rate:', error);
        return {
          rate: 16400,
          updated: new Date().toISOString()
        };
      }
    }

    // Fungsi mengisi dropdown koin
    async function populateCryptoDropdown() {
      const cryptoSelect = document.getElementById('crypto');
      
      try {
        // Clear existing options
        cryptoSelect.innerHTML = '';
        
        // Add default option
        const defaultOption = new Option('Pilih kripto...', '');
        defaultOption.disabled = true;
        defaultOption.selected = true;
        cryptoSelect.add(defaultOption);
        
        // Add crypto options
        for (const [symbol, data] of Object.entries(cryptoData)) {
          const option = new Option(`${data.name} (${symbol})`, symbol);
          option.dataset.image = data.image;
          cryptoSelect.add(option);
          console.log(`Added option: ${symbol}`);
        }
        
        // Enable select
        cryptoSelect.disabled = false;
      } catch (error) {
        console.error('Error populating dropdown:', error);
        cryptoSelect.innerHTML = '<option value="" disabled selected>Gagal memuat data koin</option>';
      }
    }

    // Fungsi update tampilan harga
    function updatePriceDisplay(symbol) {
      const crypto = cryptoData[symbol];
      if (!crypto) return;
      
      const priceElement = document.getElementById('realtime-price');
      const priceChangeElement = document.getElementById('price-change');
      const logoElement = document.getElementById('crypto-logo');
      
      // Update logo
      logoElement.src = crypto.image;
      logoElement.alt = crypto.name;
      
      // Update harga dalam IDR
      const priceIDR = crypto.price * exchangeRate;
      priceElement.textContent = `Rp ${priceIDR.toLocaleString('id-ID')}`;
      priceElement.classList.remove('loading-price');
      
      // Update indikator perubahan harga
      if (previousPrices[symbol] && previousPrices[symbol] !== crypto.price) {
        const priceChange = ((crypto.price - previousPrices[symbol]) / previousPrices[symbol]) * 100;
        const priceChangeValue = priceChange.toFixed(2);
        
        if (priceChange > 0) {
          priceChangeElement.textContent = `â†‘ ${priceChangeValue}%`;
          priceChangeElement.className = 'price-change ml-2 price-up';
        } else if (priceChange < 0) {
          priceChangeElement.textContent = `â†“ ${Math.abs(priceChangeValue)}%`;
          priceChangeElement.className = 'price-change ml-2 price-down';
        } else {
          priceChangeElement.textContent = '0.00%';
          priceChangeElement.className = 'price-change ml-2 price-neutral';
        }
        priceChangeElement.classList.remove('hidden');
      }
      
      // Simpan harga saat ini untuk perbandingan berikutnya
      previousPrices[symbol] = crypto.price;
      
      // Update kurs dan waktu
      document.getElementById('current-rate').textContent = `Kurs USD-IDR: Rp ${exchangeRate.toLocaleString('id-ID')}`;
      document.getElementById('rate-updated').textContent = `Update: ${new Date(exchangeRateLastUpdated).toLocaleTimeString()}`;
      
      // Update perhitungan
      updateCalculation();
    }

    // Fungsi update perhitungan
    function updateCalculation() {
      const symbol = document.getElementById('crypto').value;
      const amount = parseFloat(document.getElementById('amount').value.replace(/\./g, '')) || 0;
      const crypto = cryptoData[symbol];
      
      if (!symbol || !crypto) {
        document.getElementById('coin-received').textContent = '0';
        document.getElementById('fee-amount').textContent = '- Rp 0';
        return;
      }
      
      const fee = amount * 0.05; // 5% biaya
      const netAmount = amount - fee;
      const coinsReceived = netAmount / (crypto.price * exchangeRate);
      
      document.getElementById('fee-amount').textContent = `- Rp ${fee.toLocaleString('id-ID')}`;
      document.getElementById('coin-received').textContent = coinsReceived.toFixed(8);
    }

    // Fungsi untuk mengirim konfirmasi WhatsApp
    function sendWhatsAppConfirmation() {
      const crypto = document.getElementById('confirm-crypto').textContent;
      const amount = document.getElementById('confirm-amount').textContent;
      const coin = document.getElementById('confirm-coin').textContent;
      const method = selectedPaymentMethod;
      const total = document.getElementById('confirm-total').textContent;
      const wallet = document.getElementById('confirm-wallet').textContent;
      const exchangeRateInfo = document.getElementById('confirm-exchange-rate').textContent;
      
      // Daftar nama metode pembayaran
      const paymentMethodNames = {
        'bca': 'Bank BCA',
        'dana': 'DANA',
        'ovo': 'OVO',
        'gopay': 'GOPAY'
      };
      
      // Format pesan WhatsApp
      const message = `*INVOICE PEMBELIAN KRIPTO*\n` +
                      `*PT. RUANG DIGITAL RAYA*\n` +
                      `*TukarPI.ID*\n` +
                      `_Jl. TB. Simatumpang, Jakarta Selatan_\n` +
                     `================================\n` +
                     `ðŸ”¹ *Jenis Kripto:* ${crypto}\n` +
                     `ðŸ”¹ *Jumlah Pembelian:* ${amount}\n` +
                     `ðŸ”¹ *Jumlah Koin:* ${coin}\n` +
                     `ðŸ”¹ *${exchangeRateInfo}*\n` +
                     `ðŸ”¹ *Metode Pembayaran:* ${paymentMethodNames[method] || method}\n` +
                     `ðŸ”¹ *Total Pembayaran:* ${total}\n` +
                     `================================\n` +
                     `ðŸ“Œ *Alamat Wallet Tujuan:*\n${wallet}\n\n` +
                     `ðŸ’¬ *Konfirmasi Pembayaran:*\n` +
                     `Saya telah melakukan transfer pembayaran sesuai nominal di atas.\n` +
                     `Berikut bukti transfer yang telah dilakukan:\n` +
                     `_[Lampirkan screenshot bukti transfer]_`;
      
      // Encode message untuk URL
      const encodedMessage = encodeURIComponent(message);
      
      // Buka WhatsApp
      window.open(`https://wa.me/6282147510780?text=${encodedMessage}`, '_blank');
    }

<!-- Replace the existing generateInvoice() function with this new version -->
     // Fungsi utama untuk generate invoice
    async function generateInvoice() {
      // Validasi metode pembayaran
      if (!selectedPaymentMethod) {
        showNotification('Metode pembayaran belum dipilih!', 'error');
        return;
      }
    
      // Ambil semua data yang diperlukan
      const cryptoType = document.getElementById('confirm-crypto').textContent;
      const amount = document.getElementById('confirm-amount').textContent;
      const coinAmount = document.getElementById('confirm-coin').textContent;
      const fee = document.getElementById('fee-amount').textContent;
      const total = document.getElementById('confirm-total').textContent;
      const exchangeRateInfo = document.getElementById('confirm-exchange-rate').textContent;
      const realtimePrice = document.getElementById('realtime-price').textContent;
      const walletAddress = document.getElementById('wallet').value || '-';
      const now = new Date();
      const paymentDue = new Date(Date.now() + 24*60*60*1000);
      
      // Buat elemen untuk invoice
      const element = document.createElement('div');
      element.className = 'invoice-container';
      element.style.width = '210mm';
      element.style.minHeight = 'auto';
      element.style.padding = '10mm';
      element.style.margin = '0 auto';
      element.style.boxSizing = 'border-box';
      element.style.fontFamily = "'Helvetica', 'Arial', sans-serif";
      element.style.background = 'white';
      element.style.position = 'relative';
      element.style.visibility = 'hidden';
      
      // Isi template invoice
      element.innerHTML = `
        <style>
          @page {
            size: A4;
            margin: 0;
          }
          body {
            margin: 0;
            padding: 0;
            font-size: 12pt;
          }
          .invoice-container {
            width: 210mm;
            min-height: 297mm;
            padding: 10mm;
            margin: 0 auto;
            box-sizing: border-box;
            font-family: 'Helvetica', 'Arial', sans-serif;
          }
          .page-break {
            page-break-after: always;
          }
          .avoid-break {
            page-break-inside: avoid;
          }
          .invoice-header {
            margin-bottom: 12px;
          }
          .invoice-table {
            width: 100%;
            border-collapse: collapse;
          }
          .invoice-table th {
            background-color: #f8fafc;
            text-align: left;
            padding: 8px;
            font-size: 12px;
          }
          .invoice-table td {
            padding: 8px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 12px;
          }
          .text-right {
            text-align: right;
          }
          .total-box {
            width: 200px;
            margin-left: auto;
          }
          .logo {
            height: 40px;
            margin-right: 12px;
          }
          .payment-method-logo {
            height: 24px;
            vertical-align: middle;
            margin-right: 8px;
          }
          @media print {
            body {
              font-size: 10pt !important;
            }
            h1 {
              font-size: 14pt !important;
              margin-bottom: 5mm !important;
            }
            h2, h3 {
              font-size: 12pt !important;
            }
            p, td, th {
              font-size: 10pt !important;
              line-height: 1.2 !important;
            }
            .invoice-table td, .invoice-table th {
              padding: 2mm !important;
            }
          }
        </style>
    
        <!-- Header Invoice -->
        <div class="avoid-break">
          <div class="invoice-header" style="margin-bottom: 24px;">
            <table width="100%">
              <tr>
                <td>
                  <div style="display: flex; align-items: center; gap: 16px;">
                    <div style="width: 60px; height: 60px; background: #2563eb; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                      <img src="https://bakti02.github.io/TukarPI.ID/logo-jasa-tukar-pi-network.png" class="logo" alt="Logo TukarPI.ID" style="width: 80%; filter: brightness(0) invert(1);">
                    </div>
                    <div>
                      <h1 style="font-size: 18px; font-weight: 700; margin: 0 0 4px 0; color: #1e293b; letter-spacing: -0.5px;">PT. RUANG DIGITAL RAYA</h1>
                      <h2 style="font-size: 14px; color: #2563eb; margin: 0 0 6px 0; font-weight: 600;">https://tukarpi.id</h2>
                      <p style="font-style: italic; color: #64748b; font-size: 12px; margin: 0; display: flex; align-items: center; gap: 4px;">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="opacity: 0.7;">
                          <path d="M12 12.5C13.6569 12.5 15 11.1569 15 9.5C15 7.84315 13.6569 6.5 12 6.5C10.3431 6.5 9 7.84315 9 9.5C9 11.1569 10.3431 12.5 12 12.5Z" fill="#64748b"/>
                          <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.6193 11.5 9.5 10.3807 9.5 9C9.5 7.61929 10.6193 6.5 12 6.5C13.3807 6.5 14.5 7.61929 14.5 9C14.5 10.3807 13.3807 11.5 12 11.5Z" fill="#64748b"/>
                        </svg>
                        Jl. TB. Simatumpang, Jakarta Selatan
                      </p>
                    </div>
                  </div>
                </td>
                <td style="text-align: right;">
                  <div style="background: #2563eb; display: inline-block; padding: 8px 16px; border-radius: 6px; margin-bottom: 8px;">
                    <h1 style="font-size: 16px; font-weight: 700; margin: 0; color: white; letter-spacing: 0.5px;">INVOICE</h1>
                  </div>
                  <div style="display: flex; flex-direction: column; gap: 2px;">
                    <p style="color: #64748b; font-size: 12px; margin: 0; display: flex; align-items: center; justify-content: flex-end; gap: 4px;">
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="opacity: 0.7;">
                        <path d="M19 4H5C3.89543 4 3 4.89543 3 6V20C3 21.1046 3.89543 22 5 22H19C20.1046 22 21 21.1046 21 20V6C21 4.89543 20.1046 4 19 4Z" stroke="#64748b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 2V6" stroke="#64748b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 2V6" stroke="#64748b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M3 10H21" stroke="#64748b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      ${now.toLocaleString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' })}
                    </p>
                    <p style="color: #64748b; font-size: 10px; margin: 0; font-family: monospace;">
                      No: INV-${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}-${Math.floor(1000 + Math.random() * 9000)}
                    </p>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        
          <!-- Info Pembeli & Pembayaran -->
          <div style="display: flex; gap: 16px; margin-bottom: 24px;">
            <div style="flex: 1; background: white; border-radius: 8px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
              <h3 style="font-size: 14px; font-weight: 600; margin: 0 0 12px 0; color: #1e293b; display: flex; align-items: center; gap: 8px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Detail Pembeli
              </h3>
              <div style="background-color: #f8fafc; padding: 12px; border-radius: 6px; border-left: 3px solid #2563eb;">
                <p style="font-size: 12px; color: #64748b; margin: 0 0 6px 0; font-weight: 500;">Alamat Wallet</p>
                <p style="font-family: 'Roboto Mono', monospace; font-size: 13px; word-break: break-all; margin: 0; color: #1e293b; font-weight: 500;">${walletAddress}</p>
              </div>
            </div>
            
            <div style="flex: 1; background: white; border-radius: 8px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
              <h3 style="font-size: 14px; font-weight: 600; margin: 0 0 12px 0; color: #1e293b; display: flex; align-items: center; gap: 8px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 1V23" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6313 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6313 13.6815 18 14.5717 18 15.5C18 16.4283 17.6313 17.3185 16.9749 17.9749C16.3185 18.6313 15.4283 19 14.5 19H6" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Detail Pembayaran
              </h3>
              <div style="background-color: #f8fafc; padding: 12px; border-radius: 6px; border-left: 3px solid #2563eb;">
                <div style="margin-bottom: 10px;">
                  <p style="font-size: 12px; color: #64748b; margin: 0 0 4px 0; font-weight: 500;">Metode Pembayaran</p>
                  <p style="font-weight: 600; margin: 0; font-size: 13px; color: #1e293b;">
                    ${getPaymentMethodDisplay(selectedPaymentMethod)}
                  </p>
                </div>
                <div>
                  <p style="font-size: 12px; color: #64748b; margin: 0 0 4px 0; font-weight: 500;">Batas Pembayaran</p>
                  <p style="font-weight: 600; margin: 0; font-size: 13px; color: #1e293b; display: flex; align-items: center; gap: 4px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#1e293b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M12 6V12L16 14" stroke="#1e293b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    ${paymentDue.toLocaleString('id-ID', {
                        day: '2-digit',
                        month: 'long',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })}
                  </p>
                </div>
              </div>
            </div>
          </div>
        
          <!-- Detail Transaksi -->
          <div style="margin-bottom: 24px;">
            <h3 style="font-size: 14px; font-weight: 600; margin: 0 0 12px 0; color: #1e293b; display: flex; align-items: center; gap: 8px;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8 7V3M16 7V3M7 11H17M5 21H19C20.1046 21 21 20.1046 21 19V7C21 5.89543 20.1046 5 19 5H5C3.89543 5 3 5.89543 3 7V19C3 20.1046 3.89543 21 5 21Z" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Detail Transaksi
            </h3>
            <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
              <table width="100%" style="border-collapse: collapse;">
                <thead>
                  <tr style="background-color: #f1f5f9;">
                    <th style="padding: 12px 16px; text-align: left; font-size: 12px; font-weight: 600; color: #64748b;">Deskripsi</th>
                    <th style="padding: 12px 16px; text-align: right; font-size: 12px; font-weight: 600; color: #64748b;">Jumlah</th>
                    <th style="padding: 12px 16px; text-align: right; font-size: 12px; font-weight: 600; color: #64748b;">Total</th>
                  </tr>
                </thead>
                <tbody>
                  <tr style="border-bottom: 1px solid #e2e8f0;">
                    <td style="padding: 12px 16px;">
                      <p style="font-weight: 600; margin: 0 0 4px 0; font-size: 13px; color: #1e293b;">${cryptoType}</p>
                      <p style="font-size: 11px; color: #64748b; margin: 0 0 4px 0;">${exchangeRateInfo}</p>
                      <p style="font-size: 11px; color: #64748b; margin: 0;">${realtimePrice}</p>
                    </td>
                    <td style="padding: 12px 16px; text-align: right; font-size: 13px; color: #1e293b;">1</td>
                    <td style="padding: 12px 16px; text-align: right; font-size: 13px; color: #1e293b; font-weight: 600;">${amount}</td>
                  </tr>
                  <tr>
                    <td style="padding: 12px 16px; font-size: 12px; color: #64748b;">Biaya Layanan (5%)</td>
                    <td style="padding: 12px 16px;"></td>
                    <td style="padding: 12px 16px; text-align: right; color: #ef4444; font-size: 12px; font-weight: 500;">*Otomatis Terhitung</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        
          <!-- Total Pembayaran -->
          <div class="avoid-break" style="margin-bottom: 24px;">
            <div style="background: white; border-radius: 8px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
              <h3 style="font-size: 14px; font-weight: 600; margin: 0 0 16px 0; color: #1e293b; display: flex; align-items: center; gap: 8px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 1V23" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6313 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6313 13.6815 18 14.5717 18 15.5C18 16.4283 17.6313 17.3185 16.9749 17.9749C16.3185 18.6313 15.4283 19 14.5 19H6" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Ringkasan Pembayaran
              </h3>
              <table width="100%" style="margin-bottom: 8px;">
                <tr>
                  <td style="padding: 8px 0; font-size: 13px; color: #64748b;">Subtotal</td>
                  <td style="padding: 8px 0; text-align: right; font-size: 13px; color: #1e293b;">${amount}</td>
                </tr>
                <tr>
                  <td style="padding: 8px 0; font-size: 13px; color: #64748b;">Biaya Layanan</td>
                  <td style="padding: 8px 0; text-align: right; font-size: 13px; color: #ef4444;">*Otomatis Terhitung</td>
                </tr>
                <tr>
                  <td style="padding: 12px 0; border-top: 1px solid #e2e8f0; font-weight: bold; font-size: 14px; color: #1e293b;">TOTAL</td>
                  <td style="padding: 12px 0; border-top: 1px solid #e2e8f0; text-align: right; font-weight: bold; font-size: 16px; color: #2563eb;">
                    ${total}
                  </td>
                </tr>
              </table>
            </div>
          </div>
        
          <!-- Detail Koin -->
          <div style="margin-bottom: 24px;">
            <h3 style="font-size: 14px; font-weight: 600; margin: 0 0 12px 0; color: #1e293b; display: flex; align-items: center; gap: 8px;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8 14C8 14 9.5 16 12 16C14.5 16 16 14 16 14" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9 9H9.01" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M15 9H15.01" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Detail Koin
            </h3>
            <div style="background-color: white; padding: 16px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
              <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
                <div>
                  <p style="font-size: 12px; color: #64748b; margin: 0 0 6px 0; font-weight: 500;">Jenis Kripto</p>
                  <p style="font-weight: 600; margin: 0; font-size: 13px; color: #1e293b;">${cryptoType}</p>
                </div>
                <div>
                  <p style="font-size: 12px; color: #64748b; margin: 0 0 6px 0; font-weight: 500;">Jumlah Koin</p>
                  <p style="font-weight: 600; margin: 0; font-size: 13px; color: #1e293b;">${coinAmount}</p>
                </div>
                <div>
                  <p style="font-size: 12px; color: #64748b; margin: 0 0 6px 0; font-weight: 500;">Harga per Koin</p>
                  <p style="font-weight: 600; margin: 0; font-size: 13px; color: #1e293b;">${realtimePrice}</p>
                </div>
                <div>
                  <p style="font-size: 12px; color: #64748b; margin: 0 0 6px 0; font-weight: 500;">Kurs yang Berlaku</p>
                  <p style="font-weight: 600; margin: 0; font-size: 13px; color: #1e293b;">${exchangeRateInfo}</p>
                </div>
              </div>
            </div>
          </div>
        
          <!-- Instruksi Pembayaran -->
          <div style="margin-bottom: 24px;">
            <h3 style="font-size: 15px; font-weight: 700; margin: 0 0 16px 0; color: #1e293b; position: relative; padding-left: 24px;">
              <span style="position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; background: #2563eb; border-radius: 4px; display: flex; align-items: center; justify-content: center;">
                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M12 16V12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M12 8H12.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
              INSTRUKSI PEMBAYARAN
            </h3>
            
            <div style="background: white; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
              <div style="display: flex; align-items: flex-start; gap: 16px; margin-bottom: 16px;">
                <div style="flex-shrink: 0; width: 48px; height: 48px; background: #eff6ff; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8 14C8 14 9.5 16 12 16C14.5 16 16 14 16 14" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 9H9.01" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15 9H15.01" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div style="flex: 1;">
                  <p style="font-size: 13px; margin: 0 0 8px 0; color: #64748b; font-weight: 500;">Transfer ke:</p>
                  <div style="background: #f8fafc; padding: 12px 16px; border-radius: 8px; border-left: 3px solid #2563eb;">
                    <p style="margin: 0; font-family: 'Roboto Mono', monospace; font-size: 15px; font-weight: 700; color: #1e293b; letter-spacing: 0.5px;">
                      ${getPaymentMethodDetails(selectedPaymentMethod)}
                    </p>
                  </div>
                </div>
              </div>
              
              <div style="display: flex; align-items: flex-start; gap: 16px;">
                <div style="flex-shrink: 0; width: 48px; height: 48px; background: #f0fdf4; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="#16a34a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="#16a34a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div style="flex: 1;">
                  <p style="font-size: 13px; margin: 0 0 8px 0; color: #64748b; font-weight: 500;">Atas Nama:</p>
                  <p style="margin: 0; font-size: 15px; font-weight: 700; color: #1e293b;">Agus Mulia Bakti</p>
                </div>
              </div>
            </div>
          </div>
        
          <!-- Catatan -->
          <div class="avoid-break" style="margin-bottom: 24px;">
            <div style="background-color: #fff7ed; padding: 16px; border-radius: 8px; border-left: 4px solid #f97316;">
              <div style="display: flex; gap: 12px;">
                <div style="flex-shrink: 0; width: 24px; height: 24px; background: #f97316; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 8V12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 16H12.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div>
                  <p style="font-size: 13px; margin: 0 0 8px 0; font-weight: 600; color: #9a3412;">Penting untuk diperhatikan:</p>
                  <ul style="font-size: 12px; margin: 0; padding-left: 16px; list-style-type: none;">
                    <li style="margin-bottom: 6px; position: relative; padding-left: 16px;">
                      <span style="position: absolute; left: 0; top: 6px; width: 4px; height: 4px; background: #9a3412; border-radius: 50%;"></span>
                      Transfer tepat sesuai nominal total pembayaran
                    </li>
                    <li style="margin-bottom: 6px; position: relative; padding-left: 16px;">
                      <span style="position: absolute; left: 0; top: 6px; width: 4px; height: 4px; background: #9a3412; border-radius: 50%;"></span>
                      Batalkan transaksi jika tidak membayar dalam 24 jam
                    </li>
                    <li style="position: relative; padding-left: 16px;">
                      <span style="position: absolute; left: 0; top: 6px; width: 4px; height: 4px; background: #9a3412; border-radius: 50%;"></span>
                      Hubungi CS jika mengalami kendala pembayaran
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        
          <!-- Footer -->
          <div style="text-align: center; font-size: 11px; color: #64748b; border-top: 1px solid #e2e8f0; padding-top: 16px; margin-top: 8px;">
            <p style="margin: 0 0 6px 0; letter-spacing: 0.3px;">Invoice ini sah dan diterbitkan secara elektronik oleh PT. RUANG DIGITAL RAYA</p>
            <p style="margin: 0 0 6px 0; font-weight: 500; color: #1e293b;">TukarPI.ID - Platform Penukaran Kripto Terdaftar</p>
            <p style="margin: 0;">Â© ${now.getFullYear()} TukarPI.ID - All Rights Reserved</p>
          </div>
        </div>
        ;
    
      // Tambahkan ke DOM
      document.body.appendChild(element);
      
      // Tampilkan modal pilihan
      showInvoiceOptionsModal(element);
    }
    
    // Fungsi untuk menampilkan modal pilihan invoice
    function showInvoiceOptionsModal(invoiceElement) {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 flex items-center justify-center z-50 popup-overlay animate__animated animate__fadeIn';
      modal.style.backgroundColor = 'rgba(0,0,0,0.7)';
      modal.style.backdropFilter = 'blur(5px)';
      
      modal.innerHTML = `
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 animate__animated animate__zoomIn" style="box-shadow: 0 10px 25px rgba(0,0,0,0.1);">
          <div class="text-center mb-6">
            <i class="fas fa-file-invoice text-4xl text-blue-500 mb-3"></i>
            <h3 class="text-xl font-bold text-gray-800 mb-1">Pilihan Invoice</h3>
            <p class="text-gray-600">Pilih cara Anda ingin melihat invoice</p>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <button onclick="downloadInvoiceNow(this)" 
                    class="flex flex-col items-center justify-center p-4 border border-blue-200 rounded-lg hover:bg-blue-50 transition hover:shadow-md">
              <i class="fas fa-download text-2xl text-blue-500 mb-2"></i>
              <span class="font-medium">Download PNG</span>
              <span class="text-xs text-gray-500 mt-1">Simpan ke perangkat</span>
            </button>
            
            <button onclick="previewInvoice(this)" 
                    class="flex flex-col items-center justify-center p-4 border border-blue-200 rounded-lg hover:bg-blue-50 transition hover:shadow-md">
              <i class="fas fa-eye text-2xl text-blue-500 mb-2"></i>
              <span class="font-medium">Preview</span>
              <span class="text-xs text-gray-500 mt-1">Lihat sebelum download</span>
            </button>
          </div>
          
          <button onclick="closeInvoiceModal(this)" 
                  class="w-full mt-6 py-2 px-4 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition">
            Batal
          </button>
        </div>
      `;
      
      // Simpan referensi elemen invoice
      modal._invoiceElement = invoiceElement;
      document.body.appendChild(modal);
    }
    
    // Fungsi untuk menutup modal invoice
    function closeInvoiceModal(btn) {
      const modal = btn.closest('.popup-overlay');
      const invoiceElement = modal._invoiceElement;
      
      // Hapus elemen invoice dan modal
      if (invoiceElement && invoiceElement.parentNode) {
        document.body.removeChild(invoiceElement);
      }
      modal.remove();
    }
    
    // Fungsi untuk langsung download invoice sebagai PNG
    async function downloadInvoiceNow(btn) {
      const modal = btn.closest('.popup-overlay');
      const element = modal._invoiceElement;
      
      // Tampilkan elemen sebelum konversi
      element.style.visibility = 'visible';
    
      try {
        // Gunakan html2canvas untuk konversi ke gambar
        const canvas = await html2canvas(element, {
          scale: 2,
          logging: false,
          useCORS: true,
          allowTaint: true,
          scrollX: 0,
          scrollY: 0,
          width: element.scrollWidth,
          height: element.scrollHeight,
          windowWidth: element.scrollWidth
        });
    
        // Konversi canvas ke data URL
        const imageData = canvas.toDataURL('image/png');
        
        // Buat link download
        const link = document.createElement('a');
        const timestamp = new Date().getTime();
        link.download = `Invoice-TukarPI-${timestamp}.png`;
        link.href = imageData;
        
        // Trigger download
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // Tampilkan notifikasi sukses
        showNotification('Invoice berhasil didownload sebagai PNG', 'success');
      } catch (error) {
        console.error('Error generating image:', error);
        showNotification('Gagal membuat gambar invoice', 'error');
      } finally {
        // Hapus modal dan elemen invoice
        closeInvoiceModal(btn);
      }
    }
    
    // Fungsi untuk preview invoice sebelum download
    function previewInvoice(btn) {
      const modal = btn.closest('.popup-overlay');
      const element = modal._invoiceElement;
      
      // Tampilkan elemen invoice
      element.style.visibility = 'visible';
      
      // Buat popup preview
      const previewModal = document.createElement('div');
      previewModal.className = 'fixed inset-0 flex items-center justify-center z-50 popup-overlay animate__animated animate__fadeIn';
      previewModal.style.backgroundColor = 'rgba(0,0,0,0.7)';
      previewModal.style.backdropFilter = 'blur(5px)';
      
      previewModal.innerHTML = `
        <div class="bg-white rounded-xl p-0 max-w-4xl w-full mx-4 h-[90vh] flex flex-col animate__animated animate__zoomIn" style="box-shadow: 0 10px 25px rgba(0,0,0,0.1);">
          <div class="flex justify-between items-center p-4 border-b">
            <h3 class="text-lg font-bold">Preview Invoice</h3>
            <button onclick="closePreviewModal(this)" class="text-gray-500 hover:text-gray-700">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <div class="flex-1 overflow-auto p-4">
            ${element.innerHTML}
          </div>
          
          <div class="flex justify-end p-4 border-t gap-2">
            <button onclick="closePreviewModal(this)" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg">
              Tutup
            </button>
            <button onclick="downloadFromPreview(this)" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
              <i class="fas fa-download mr-2"></i> Download PNG
            </button>
          </div>
        </div>
      `;
      
      // Simpan referensi elemen
      previewModal._invoiceElement = element;
      previewModal._originalModal = modal;
      
      // Hapus modal pilihan
      modal.remove();
      
      // Tampilkan preview modal
      document.body.appendChild(previewModal);
    }
    
    // Fungsi untuk menutup preview modal
    function closePreviewModal(btn) {
      const previewModal = btn.closest('.popup-overlay');
      const invoiceElement = previewModal._invoiceElement;
      
      // Hapus preview modal
      previewModal.remove();
      
      // Kembalikan ke modal pilihan
      showInvoiceOptionsModal(invoiceElement);
    }
    
    // Fungsi untuk download dari preview sebagai PNG
    async function downloadFromPreview(btn) {
      const previewModal = btn.closest('.popup-overlay');
      const invoiceElement = previewModal._invoiceElement;
      
      // Tutup preview modal
      previewModal.remove();
      
      try {
        // Gunakan html2canvas untuk konversi ke gambar
        const canvas = await html2canvas(invoiceElement, {
          scale: 2,
          logging: false,
          useCORS: true,
          allowTaint: true,
          scrollX: 0,
          scrollY: 0,
          width: invoiceElement.scrollWidth,
          height: invoiceElement.scrollHeight,
          windowWidth: invoiceElement.scrollWidth
        });
    
        // Konversi canvas ke data URL
        const imageData = canvas.toDataURL('image/png');
        
        // Buat link download
        const link = document.createElement('a');
        const timestamp = new Date().getTime();
        link.download = `Invoice-TukarPI-${timestamp}.png`;
        link.href = imageData;
        
        // Trigger download
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // Tampilkan notifikasi sukses
        showNotification('Invoice berhasil didownload sebagai PNG', 'success');
      } catch (error) {
        console.error('Error generating image:', error);
        showNotification('Gagal membuat gambar invoice', 'error');
      } finally {
        // Hapus elemen invoice
        if (invoiceElement && invoiceElement.parentNode) {
          document.body.removeChild(invoiceElement);
        }
      }
    }
    
    // Fungsi helper untuk menampilkan metode pembayaran
    function getPaymentMethodDisplay(method) {
      const methods = {
        'bca': '<img src="https://upload.wikimedia.org/wikipedia/commons/5/5c/Bank_Central_Asia.svg" class="payment-method-logo" alt="BCA"> Bank BCA',
        'dana': '<img src="https://upload.wikimedia.org/wikipedia/commons/7/72/Logo_dana_blue.svg" class="payment-method-logo" alt="DANA"> DANA',
        'ovo': '<img src="https://upload.wikimedia.org/wikipedia/commons/e/eb/Logo_ovo_purple.svg" class="payment-method-logo" alt="OVO"> OVO',
        'gopay': '<img src="https://upload.wikimedia.org/wikipedia/commons/8/86/Gopay_logo.svg" class="payment-method-logo" alt="GOPAY"> GOPAY'
      };
      return methods[method] || method;
    }
    
    // Fungsi helper untuk detail metode pembayaran
    function getPaymentMethodDetails(method) {
      const methods = {
        'bca': 'BCA 0332997201',
        'dana': 'DANA 087878787523',
        'ovo': 'OVO 087878787523',
        'gopay': 'GOPAY 087878787523'
      };
      return methods[method] || '';
    }
    
    // Fungsi untuk menampilkan notifikasi
    function showNotification(message, type) {
      const notification = document.createElement('div');
      notification.className = `fixed bottom-4 right-4 ${
        type === 'success' ? 'bg-green-500' : 'bg-red-500'
      } text-white px-4 py-3 rounded-lg shadow-lg flex items-center animate__animated animate__fadeInUp`;
      notification.innerHTML = `
        <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-2"></i>
        <span>${message}</span>
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.add('animate__fadeOut');
        setTimeout(() => notification.remove(), 500);
      }, 3000);
    }
    // Copy to clipboard function dengan popup modern
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        // Buat popup modern
        const popup = document.createElement('div');
        popup.className = 'fixed inset-0 flex items-center justify-center z-50 popup-overlay animate__animated animate__fadeIn';
        popup.innerHTML = `
          <div class="bg-white rounded-xl p-6 max-w-sm w-full mx-4 animate__animated animate__zoomIn">
            <div class="flex justify-center text-green-500 mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <h3 class="text-lg font-bold text-center text-gray-800 mb-2">Berhasil Disalin!</h3>
            <p class="text-gray-600 text-center mb-4">Nomor rekening telah disalin ke clipboard</p>
            <div class="bg-gray-100 p-3 rounded-lg">
              <code class="text-sm font-mono text-gray-800 break-all">${text}</code>
            </div>
            <button onclick="this.parentElement.parentElement.remove()" class="mt-4 w-full py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition">
              Tutup
            </button>
          </div>
        `;
        document.body.appendChild(popup);
        
        // Auto close setelah 3 detik
        setTimeout(() => {
          popup.classList.add('animate__fadeOut');
          setTimeout(() => popup.remove(), 500);
        }, 3000);
      }).catch(err => {
        console.error('Gagal menyalin:', err);
        // Tampilkan popup error
        const popup = document.createElement('div');
        popup.className = 'fixed inset-0 flex items-center justify-center z-50 popup-overlay animate__animated animate__fadeIn';
        popup.innerHTML = `
          <div class="bg-white rounded-xl p-6 max-w-sm w-full mx-4 animate__animated animate__zoomIn">
            <div class="flex justify-center text-red-500 mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
              </svg>
            </div>
            <h3 class="text-lg font-bold text-center text-gray-800 mb-2">Gagal Menyalin</h3>
            <p class="text-gray-600 text-center mb-4">Silahkan coba lagi atau salin manual</p>
            <div class="bg-gray-100 p-3 rounded-lg">
              <code class="text-sm font-mono text-gray-800 break-all">${text}</code>
            </div>
            <button onclick="this.parentElement.parentElement.remove()" class="mt-4 w-full py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition">
              Tutup
            </button>
          </div>
        `;
        document.body.appendChild(popup);
      });
    }

    // Confirm payment dengan popup modern
    async function confirmPayment() {
      // Buat popup konfirmasi modern
      const popup = document.createElement('div');
      popup.className = 'fixed inset-0 flex items-center justify-center z-50 popup-overlay animate__animated animate__fadeIn';
      popup.innerHTML = `
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 animate__animated animate__zoomIn">
          <div class="flex justify-center text-blue-500 mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
            </svg>
          </div>
          <h3 class="text-xl font-bold text-center text-gray-800 mb-3">Konfirmasi Pembayaran</h3>
          
          <div class="flex flex-col space-y-4 mb-6">
            <div class="flex items-center p-3 bg-gray-50 rounded-lg">
              <input type="radio" id="confirm-yes" name="payment-confirm" class="h-5 w-5 text-blue-600" checked>
              <label for="confirm-yes" class="ml-3 flex-1">
                <span class="block font-medium">Sudah Transfer</span>
                <span class="block text-sm text-gray-500">Saya sudah melakukan pembayaran</span>
              </label>
            </div>
            
            <div class="flex items-center p-3 bg-gray-50 rounded-lg">
              <input type="radio" id="confirm-no" name="payment-confirm" class="h-5 w-5 text-blue-600">
              <label for="confirm-no" class="ml-3 flex-1">
                <span class="block font-medium">Belum Transfer</span>
                <span class="block text-sm text-gray-500">Saya akan bayar nanti</span>
              </label>
            </div>
          </div>
          
          <div class="flex space-x-3">
            <button onclick="this.parentElement.parentElement.remove()" class="flex-1 py-2 px-4 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg transition">
              Batal
            </button>
            <button onclick="processPaymentConfirmation(this)" class="flex-1 py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition">
              Lanjutkan
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(popup);
    }

    function processPaymentConfirmation(btn) {
      const isConfirmed = document.getElementById('confirm-yes').checked;
      
      if (isConfirmed) {
        // Tutup popup
        btn.closest('.popup-overlay').remove();
        
        // Update tombol konfirmasi
        const confirmBtn = document.querySelector('#payment-info button[onclick="confirmPayment()"]');
        confirmBtn.innerHTML = '<i class="fab fa-whatsapp mr-2"></i> Konfirmasi via WhatsApp';
        confirmBtn.classList.remove('from-green-500', 'to-emerald-600', 'hover:from-green-600', 'hover:to-emerald-700');
        confirmBtn.classList.add('from-green-600', 'to-emerald-700', 'hover:from-green-700', 'hover:to-emerald-800');
        confirmBtn.removeAttribute('onclick');
        confirmBtn.addEventListener('click', sendWhatsAppConfirmation);
        
        // Tampilkan notifikasi
        const notification = document.createElement('div');
        notification.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-3 rounded-lg shadow-lg flex items-center animate__animated animate__fadeInUp';
        notification.innerHTML = `
          <i class="fas fa-check-circle mr-2"></i>
          <span>Silahkan lanjutkan konfirmasi via WhatsApp</span>
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.classList.add('animate__fadeOut');
          setTimeout(() => notification.remove(), 500);
        }, 3000);
      } else {
        // Tampilkan pesan untuk belum transfer
        const popup = document.querySelector('.popup-overlay');
        popup.innerHTML = `
          <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 animate__animated animate__zoomIn">
            <div class="flex justify-center text-yellow-500 mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
              </svg>
            </div>
            <h3 class="text-xl font-bold text-center text-gray-800 mb-3">Pembayaran Belum Dilakukan</h3>
            <p class="text-gray-600 text-center mb-6">Silahkan lakukan pembayaran terlebih dahulu sebelum melanjutkan. Invoice telah tersedia untuk Anda download.</p>
            <button onclick="this.parentElement.parentElement.remove()" class="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition">
              Mengerti
            </button>
          </div>
        `;
      }
    }

    // Format input amount
    function formatAmountInput(input) {
      // Remove non-numeric characters
      let value = input.value.replace(/[^0-9]/g, '');
      
      // Format with thousand separators
      if (value.length > 0) {
        value = parseInt(value, 10).toLocaleString('id-ID');
      }
      
      input.value = value;
      updateCalculation();
    }

    // Inisialisasi
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        console.log('Initializing...');
        
        // Setup mobile menu toggle
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
          const menu = document.getElementById('mobile-menu');
          menu.classList.toggle('hidden');
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(e) {
          const menu = document.getElementById('mobile-menu');
          const button = document.getElementById('mobile-menu-button');
          
          if (!menu.contains(e.target) && e.target !== button && !button.contains(e.target)) {
            menu.classList.add('hidden');
          }
        });
        
        // Setup payment method selection
        document.querySelectorAll('.payment-card').forEach(card => {
          card.addEventListener('click', function() {
            // Remove selected class from all cards
            document.querySelectorAll('.payment-card').forEach(c => {
              c.classList.remove('selected');
            });
            
            // Add selected class to clicked card
            this.classList.add('selected');
            
            // Set payment method value
            const method = this.getAttribute('data-method');
            document.getElementById('payment-method').value = method;
          });
        });
        
        // Setup amount input formatting
        document.getElementById('amount').addEventListener('input', function() {
          formatAmountInput(this);
        });
        
        // Load data
        const [cryptoDataResponse, exchangeRateData] = await Promise.all([
          fetchCryptoData(),
          fetchExchangeRate()
        ]);
        
        cryptoData = cryptoDataResponse;
        exchangeRate = exchangeRateData.rate;
        exchangeRateLastUpdated = exchangeRateData.updated;
        
        console.log('Crypto data loaded:', cryptoData);
        console.log('Exchange rate:', exchangeRate);
        
        // Populate dropdown
        await populateCryptoDropdown();
        
        // Setup event listeners
        document.getElementById('crypto').addEventListener('change', function() {
          updatePriceDisplay(this.value);
        });
        
        // Auto-update setiap 1 menit
        setInterval(async () => {
          cryptoData = await fetchCryptoData();
          const exchangeRateData = await fetchExchangeRate();
          exchangeRate = exchangeRateData.rate;
          exchangeRateLastUpdated = exchangeRateData.updated;
          
          const currentSymbol = document.getElementById('crypto').value;
          if (currentSymbol) updatePriceDisplay(currentSymbol);
        }, 300000); // 1 menit
        
      } catch (error) {
        console.error('Initialization error:', error);
        document.getElementById('crypto').innerHTML = 
          '<option value="" disabled selected>Gagal memuat daftar koin</option>';
      }
    });

    // Form submission
    document.getElementById('purchase-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Validate form
      const amount = document.getElementById('amount').value.replace(/\./g, '');
      const wallet = document.getElementById('wallet').value;
      const paymentMethod = document.getElementById('payment-method').value;
      
      if (!amount || parseFloat(amount) < 10000) {
        alert('Minimal pembelian Rp 10.000');
        return;
      }
      
      if (!wallet) {
        alert('Masukkan alamat wallet Anda');
        return;
      }
      
      if (!paymentMethod) {
        alert('Pilih metode pembayaran');
        return;
      }
      
      // Simpan metode pembayaran yang dipilih
      selectedPaymentMethod = paymentMethod;
      
      // Set confirmation values
      const crypto = document.getElementById('crypto').value;
      const cryptoName = cryptoData[crypto]?.name || crypto;
      const coinReceived = document.getElementById('coin-received').textContent;
      const walletAddress = document.getElementById('wallet').value;
      
      document.getElementById('confirm-crypto').textContent = `${cryptoName} (${crypto})`;
      document.getElementById('confirm-amount').textContent = `Rp ${parseFloat(amount).toLocaleString('id-ID')}`;
      document.getElementById('confirm-coin').textContent = coinReceived;
      
      // Update payment method display
      const methodDisplay = document.getElementById('confirm-method');
      methodDisplay.innerHTML = '';
      
      const methodImg = document.createElement('img');
      methodImg.src = `https://upload.wikimedia.org/wikipedia/commons/${ 
        paymentMethod === 'bca' ? '5/5c/Bank_Central_Asia.svg' : 
        paymentMethod === 'dana' ? '7/72/Logo_dana_blue.svg' : 
        paymentMethod === 'ovo' ? 'e/eb/Logo_ovo_purple.svg' : 
        '8/86/Gopay_logo.svg'}`;
      methodImg.className = 'h-5 mr-2';
      methodImg.alt = paymentMethod;
      
      const methodText = document.createElement('span');
      methodText.className = 'text-sm';
      methodText.textContent = 
        paymentMethod === 'bca' ? 'BCA' : 
        paymentMethod === 'dana' ? 'DANA' : 
        paymentMethod === 'ovo' ? 'OVO' : 'GOPAY';
      
      methodDisplay.appendChild(methodImg);
      methodDisplay.appendChild(methodText);
      
      document.getElementById('confirm-total').textContent = `Rp ${parseFloat(amount).toLocaleString('id-ID')}`;
      document.getElementById('confirm-wallet').textContent = walletAddress;
      document.getElementById('confirm-exchange-rate').textContent = `Kurs USD-IDR: Rp ${exchangeRate.toLocaleString('id-ID')}`;
      document.getElementById('confirm-rate-updated').textContent = `Update: ${new Date(exchangeRateLastUpdated).toLocaleTimeString()}`;
      
      // Show corresponding payment details
      document.querySelectorAll('#payment-details > div').forEach(div => {
        div.classList.add('hidden');
      });
      document.getElementById(`${paymentMethod}-details`).classList.remove('hidden');
      
      // Show payment info
      document.getElementById('purchase-form-container').classList.add('hidden');
      document.getElementById('payment-info').classList.remove('hidden');
      
      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>
</body>
</html>
